import axios from "axios";

export default (app) => {

  async function fetchNik(nik) {
    try {
      const response = await axios.get(
        "https://api.siputzx.my.id/api/tools/nik-checker",
        { params: { nik } }
      );
      return response.data; // response dari API sudah lengkap
    } catch (error) {
      console.error("Error fetching NIK:", error.message);
      throw error;
    }
  }

  app.get("/api/nik", async (req, res) => {
    const { nik } = req.query;

    // Validasi NIK 16 digit
    if (!nik) {
      return res.status(400).json({ status: false, error: "NIK required" });
    }
    if (!/^\d{16}$/.test(nik)) {
      return res.status(400).json({ status: false, error: "NIK must be 16 digits" });
    }

    try {
      const apiResponse = await fetchNik(nik);

      // Kirim response lengkap seperti API
      res.status(200).json({
        status: apiResponse.status,
        data: apiResponse.data,
        timestamp: apiResponse.timestamp
      });

    } catch (error) {
      res.status(500).json({ status: false, error: error.message });
    }
  });

};
